# -*- coding: utf-8 -*-
"""ÐšÐ¾Ð¿Ð¸Ñ Ð±Ð»Ð¾ÐºÐ½Ð¾Ñ‚Ð° "ÐŸÑƒÐ½ÐºÑ‚_1.ipynb"

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1eR1Xx1iT5RVbhtukDRWThWGBjGb2nQKL

*   Ð¤Ð˜Ðž Ð‘Ð°Ñ€Ð±Ð°ÑˆÐ¸Ð½ ÐÐ½Ð´Ñ€ÐµÐ¹ ÐÐ»ÐµÐºÑÐµÐµÐ²Ð¸Ñ‡
*   Ð“Ñ€ÑƒÐ¿Ð¿Ð° Ð¢Ð¤Ñ-01-20
*   Ð¢Ð»ÐµÐ³Ñ€Ð°Ð¼Ð¼ @QwertyAlexx
"""

!pip install iapws

"""# Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ â„–1
Ð”Ð°Ð½Ð¾:
* Ð¢Ð¸Ð¿ Ñ‚ÑƒÑ€Ð±Ð¸Ð½Ñ‹: Ðš-800-23,5 Ð›ÐœÐ—;
* P0 = 25 ÐœÐŸÐ°; t0 = 560 C; PÐ¿Ð¿ = 3,63 ÐœÐŸÐ°; tÐ¿Ð¿ = 565 Ð¡; PÐº = 3,5 ÐºÐŸÐ°; 
tÐ¿Ð² = 269 C; NÑ = 830 ÐœÐ’Ñ‚; z = 9 ÑˆÑ‚; dÑ€.Ñ. = 0,9-1,1 Ð¼; n = 50 (1/c); H0 = 105 ÐºÐ”Ð¶/ÐºÐ³

1. ÐŸÐ¾ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ Ð¿Ð°Ñ€Ð° Ð² Ñ‚ÑƒÑ€Ð±Ð¸Ð½Ðµ. ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ñ€Ð°ÑÑ…Ð¾Ð´Ð¾Ð² Ð¿Ð°Ñ€Ð° Ð½Ð° 
Ð²Ñ…Ð¾Ð´Ðµ Ð² Ñ‚ÑƒÑ€Ð±Ð¸Ð½Ñƒ (G0) Ð¸ Ð² ÐºÐ¾Ð½Ð´ÐµÐ½ÑÐ°Ñ‚Ð¾Ñ€ (GÐº).
"""

import matplotlib.pyplot as plt
import numpy as np
import iapws
from iapws import IAPWS97 as gas

MPa = 10 ** 6
kPa = 10 ** 3
unit = 1 / MPa
to_kelvin = lambda x: x + 273.15 if x else None

#Ð˜ÑÑ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
#Ð¢Ð¸Ð¿ Ñ‚ÑƒÑ€Ð±Ð¸Ð½Ñ‹ Ðš-800-23,5 Ð›ÐœÐ—

p_0 = 25 * MPa #ÐÐ°Ñ‡Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ
t_0 = 560 #ÐÐ°Ñ‡Ð°Ð»ÑŒÐ½Ð°Ñ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ð°
p_middle = 3.62 * MPa #Ð”Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð¼Ð¿ÐµÑ€ÐµÐ³Ñ€ÐµÐ²Ð°
t_middle = 565 #Ð¢ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾Ð¼Ð¿ÐµÑ€ÐµÐ³Ñ€ÐµÐ²Ð°
p_k = 3.5 * kPa #Ð”Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð² ÐºÐ¾Ð½Ð´ÐµÐ½ÑÐ°Ñ‚Ð¾Ñ€Ðµ
t_feed_water = 269 #Ð¢ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ð° Ð¿Ð¸Ñ‚Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð²Ð¾Ð´Ñ‹
electrical_power = 830 * (10 ** 6) #Ð­Ð»ÐµÐºÑ‚Ñ€Ð¸Ñ‡ÐµÑÑÐºÐ°Ñ Ð¼Ð¾Ñ‰Ð½Ð¾ÑÑ‚ÑŒ
z = 9 #Ð§Ð¸ÑÐ»Ð¾ Ð¾Ñ‚Ð±Ð¾Ñ€Ð¾Ð² ÑˆÑ‚.
avg_diameter = 0.9 # dÑ€.Ñ. = 0,9 - 1,1
rotation_speed = 50 #n
H_0 = 105
p_feed_water = 1.35 * p_0 #Ð”Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¸Ñ‚Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð²Ð¾Ð´Ñ‹

#ÐšÐŸÐ”
internal_efficiency = 0.85
mechanical_efficiency = 0.994
generator_efficiency = 0.99

#ÐŸÐ¾Ñ‚ÐµÑ€Ð¸ Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ñ
delta_p0 = 0.05 * p_0
delta_p_middle = 0.1 * p_middle
delta_p_1 = 0.03 * p_middle


real_p0 = p_0 - delta_p0
real_p1t = p_middle + delta_p_middle
real_p_middle = p_middle - delta_p_1

def get_points():
  _point_0 = gas(P = p_0 * unit, T=to_kelvin(t_0))
  point_0 = gas(P=real_p0 * unit, h=_point_0.h)
  point_1t = gas(P=real_p1t * unit, s=_point_0.s)

  hp_heat_drop = (_point_0.h - point_1t.h) * internal_efficiency
  h_1 = point_0.h - hp_heat_drop
  point_1 = gas(P=real_p1t * unit, h=h_1)

  _point_middle = gas(P=p_middle * unit, T=to_kelvin(t_middle))
  point_middle = gas(P=real_p_middle * unit, h=_point_middle.h)
  point_2t = gas(P=p_k * unit, s=_point_middle.s)

  lp_heat_drop = (_point_middle.h - point_2t.h) * internal_efficiency
  h_2 = point_middle.h - lp_heat_drop
  point_2 = gas(P=p_k * unit, h=h_2)
  point_k_water = gas(P=p_k * unit, x=0)
  point_feed_water = gas(P=p_feed_water * unit, T=to_kelvin(t_feed_water))
  return _point_0, point_0, point_1t, hp_heat_drop, point_1, _point_middle, point_middle, lp_heat_drop, point_2, point_k_water, point_feed_water

_point_0, point_0, point_1t, hp_heat_drop, point_1, _point_middle, point_middle, lp_heat_drop, point_2, point_k_water, point_feed_water = get_points()

def get_ksi(point_0, point_1t, _point_middle, point_middle, point_2, point_k_water, point_feed_water):
  numenator_without = point_2.T * (_point_middle.s - point_k_water.s)
  denumenator_without = (point_0.h - point_1t.h) + (point_middle.h - point_k_water.h)
  without_part = 1 - (numenator_without / denumenator_without)

  numenator_infinity = point_2.T * (_point_middle.s - point_feed_water.s)
  denumenator_infinity = (point_0.h - point_1t.h) + (point_middle.h - point_feed_water.h)
  infinity_part = 1 - (numenator_infinity / denumenator_infinity)

  ksi_infinity = 1 - (without_part / infinity_part)
  coeff = (point_feed_water.T - point_2.T) / (to_kelvin(374.2) - point_2.T)
  print(coeff)
  ksi = 0.83 * ksi_infinity
  return ksi

ksi = get_ksi(point_0, point_1t, _point_middle, point_middle, point_2, point_k_water, point_feed_water)

#ÐšÐŸÐ”
def get_eff(hp_heat_drop, lp_heat_drop, point_middle, point_k_water, point_feed_water, ksi, point_0, point_1):
  eff_num = hp_heat_drop + lp_heat_drop
  eff_denum = hp_heat_drop + (point_middle.h - point_k_water.h)

  efficiency = (eff_num / eff_denum) * (1 / (1 - ksi))

  estimated_heat_drop = efficiency * ((point_0.h - point_feed_water.h) + (point_middle.h - point_1.h))
  return efficiency, estimated_heat_drop

#ÐœÐ°ÑÑÐ¾Ð²Ñ‹Ð¹ Ñ€Ð°ÑÑ…Ð¾Ð´ Ð² Ñ‚ÑƒÑ€Ð±Ð¸Ð½Ñƒ Ð½Ð° Ð²Ñ…Ð¾Ð´Ðµ
def get_inlet_mass_flow(estimated_heat_drop):
  inlet_mass_flow = electrical_power / (estimated_heat_drop * 1000 * mechanical_efficiency * generator_efficiency)
  return inlet_mass_flow

#ÐœÐ°ÑÑÐ¾Ð²Ñ‹Ð¹ Ñ€Ð°ÑÑ…Ð¾Ð´ Ð² ÐºÐ¾Ð½Ð´ÐµÐ½ÑÐ°Ñ‚Ð¾Ñ€
def get_condenser_mass_flow(point_2, point_k_water, efficiency):
  condenser_mass_flow = (electrical_power /((point_2.h - point_k_water.h) * 1000 * mechanical_efficiency * generator_efficiency) * ((1 / efficiency) - 1))
  return condenser_mass_flow

efficiency, estimated_heat_drop = get_eff(hp_heat_drop, lp_heat_drop, point_middle, point_k_water, point_feed_water, ksi, point_0, point_1)
G_0 = get_inlet_mass_flow(estimated_heat_drop)
G_k = get_condenser_mass_flow(point_2, point_k_water, efficiency)

print("ÐœÐ°ÑÑÐ¾Ð²Ñ‹Ð¹ Ñ€Ð°ÑÑ…Ð¾Ð´ Ð² Ñ‚ÑƒÑ€Ð±Ð¸Ð½Ñƒ Ð½Ð° Ð²Ñ…Ð¾Ð´Ðµ", round(G_0, 3))
print("ÐœÐ°ÑÑÐ¾Ð²Ñ‹Ð¹ Ñ€Ð°ÑÑ…Ð¾Ð´ Ð² ÐºÐ¾Ð½Ð´ÐµÐ½ÑÐ°Ñ‚Ð¾Ñ€:", round(G_k, 3))

#ÐŸÐ¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ° Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ Ð² Ñ‚ÑƒÑ€Ð±Ð¸Ð½Ðµ 
def get_izobar(point):
  t0 = np.arange(10,800,10)
  t_00 = list(map(to_kelvin,t0))

  points_s = [] 
  points_h = []
  for value in t_00:
    if (gas(P = point.P, T=value).s > 6 and gas(P = point.P, T=value).s < 9):
      points_s.append(gas(P = point.P, T=value).s)
      points_h.append(gas(P = point.P, T=value).h)  
  return points_h, points_s

def multiply1(x):
    return x * 10**6

def get_izoterm(point):
  p_00 = np.arange(0.001,30,0.1)
  p_00 = list(map(multiply1,p_00))

  points_ss = [] 
  points_hh = []
  for value in p_00:
    if (gas(P = value * unit, T=point.T).s > 6 and gas(P = value * unit, T=point.T).s < 8):
      points_ss.append(gas(P = value * unit, T=point.T).s)
      points_hh.append(gas(P = value * unit, T=point.T).h)
  return points_hh, points_ss

fig, ax = plt.subplots(1,1,figsize=(10,10))

def plot_hs(points: list, ax):
  for point in points:
    izobar_h, izobar_s = get_izobar(point)
    izoterm_h, izoterm_s = get_izoterm(point)   
    ax.plot(izobar_s, izobar_h, color="blue")
    ax.plot(izoterm_s, izoterm_h, color="red")
    ax.scatter(point.s, point.h)
    
def plot_process(points, ax):
  ax.plot([point.s for point in  points], [point.h for point in points], color="black")
  

plt.xlabel("Ð­Ð½Ñ‚Ñ€Ð¾Ð¿Ð¸Ñ, S")
plt.ylabel("Ð­Ð½Ñ‚Ð°Ð»ÑŒÐ¿Ð¸Ñ, H")
plt.grid()
plot_hs([_point_0, point_0, point_1], ax = ax)
plot_hs([_point_middle, point_middle, point_2], ax = ax)
plot_process([_point_0, point_0, point_1], ax = ax)
plot_process([_point_middle, point_middle, point_2], ax = ax)
plt.show()

"""2. ÐŸÑ€Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ñ€Ð°ÑÑ‡ÐµÑ‚Ð° Ñ€ÐµÐ³ÑƒÐ»Ð¸Ñ€ÑƒÑŽÑ‰ÐµÐ¹ ÑÑ‚ÑƒÐ¿ÐµÐ½Ð¸ Ð¸ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Î·Ð¾Ð» Ð¾Ñ‚ 
U/cÑ„. Ð”Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½ Ð²Ð°Ñ€ÑŒÐ¸Ñ€ÑƒÐµÐ¼Ð¾Ð³Ð¾ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð° Ð´Ð»Ñ Ð´Ð°Ð½ Ð² Ð·Ð°Ð´Ð°Ð½Ð¸Ð¸. ÐžÐ±Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð½Ð¾ 
Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð¸ÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ñ€ÐµÐ³ÑƒÐ»Ð¸Ñ€ÑƒÑŽÑ‰ÐµÐ¹ ÑÑ‚ÑƒÐ¿ÐµÐ½Ð¸ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¦Ð’Ð”
Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð·Ð°Ð´Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ð°.
"""

import math as m
import numpy as np

#Ð¾ÐºÑ€ÑƒÐ¶Ð½Ð°Ñ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ Ð½Ð° ÑÑ€ÐµÐ´Ð½ÐµÐ¼ Ð´Ð¸Ð°Ð¼ÐµÑ‚Ñ€Ðµ u
u = m.pi * avg_diameter * rotation_speed
#ÑÑ‚ÐµÐ¿ÐµÐ½ÑŒ Ñ€ÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸
ro = 0.05 #ÑÑ‚ÐµÐ¿ÐµÐ½ÑŒ Ñ€ÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð¿Ñ€Ð¸Ð½ÑÑ‚ÑŒ Ð² Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ðµ 0,05-0,1
#Ð˜Ð·Ð¾ÑÐ½Ñ‚Ñ€Ð¾Ð¿Ð¸Ð¹Ð½Ñ‹Ð¹ Ñ‚ÐµÐ¿Ð»Ð¾Ð¿ÐµÑ€ÐµÐ¿Ð°Ð´ ÑÐ¾Ð¿Ð»Ð¾Ð²Ð¾Ð¹ Ñ€ÐµÑˆÐµÑ‚ÐºÐ¸ Ð¿Ð¾ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼ Ñ‚Ð¾Ñ€Ð¼Ð¾Ð¶ÐµÐ½Ð¸Ñ
Hoc = (1 - ro) * H_0
#Ð˜Ð·Ð¾ÑÐ½Ñ‚Ñ€Ð¾Ð¿Ð¸Ð¹Ð½Ñ‹Ð¹ Ñ‚ÐµÐ¿Ð»Ð¾Ð¿ÐµÑ€ÐµÐ¿Ð°Ð´ Ð² Ñ€Ð°Ð±Ð¾Ñ‡ÐµÐ¹ Ñ€ÐµÑˆÐµÑ‚ÐºÐµ Ð¿Ð¾ ÑÑ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼
Hop = H_0 * ro
#Ð¢ÐµÐ¾Ñ€ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑÐ½Ñ‚Ð°Ð»ÑŒÐ¿Ð¸Ñ Ð·Ð° ÑÐ¾Ð¿Ð»Ð¾Ð²Ð¾Ð¹ Ñ€ÐµÑˆÐµÑ‚ÐºÐ¾Ð¹
h1t = _point_0.h - Hoc
#Ð¢ÐµÐ¾Ñ€ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ Ð²Ñ‹Ñ…Ð¾Ð´Ð° Ð¸Ð· ÑÐ¾Ð¿Ð»Ð¾Ð²Ñ‹Ñ… Ð»Ð¾Ð¿Ð°Ñ‚Ð¾Ðº
c1t = m.sqrt(2 * H_0)
#Ð¡ÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ Ð·Ð²ÑƒÐºÐ° Ð·Ð° ÑÐ¾Ð¿Ð»Ð¾Ð²Ð¾Ð¹ Ñ€ÐµÑˆÐµÑ‚ÐºÐ¾Ð¹ (Ñ‚ÐµÐ¾Ñ€ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ)
k = 1.380649 * (10 ** -23)
p1 = gas(h = h1t, s = _point_0.s)
v1 = gas(h = h1t, s = _point_0.s)
a1t = m.sqrt(k * p1.T * v1.T)
#Ð§Ð¸ÑÐ»Ð¾ ÐœÐ°Ñ…Ð° Ð¿Ð¾ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚Ð¸ c1t
M1t = c1t / a1t
#Ð’Ñ‹Ñ…Ð¾Ð´Ð½Ð°Ñ Ð¿Ð»Ð¾Ñ‰Ð°Ð´ÑŒ ÑÐ¾Ð¿Ð»Ð¾Ð²Ð¾Ð¹ Ñ€ÐµÑˆÐµÑ‚ÐºÐ¸ (Ð¿Ñ€ÐµÐ´Ð²Ð°Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ) 
mu1 = 0.97
F1 = (G_0 * v1.T) / (mu1 * c1t)
alfa1_e = 10 #Ð£Ð³Ð¾Ð» Î±1Ñ Ð½Ð°Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚Ð¸ Ñ1t, Ð³Ñ€Ð°Ð´ ÐŸÑ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÐ¼ Ð² Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ðµ Î±1Ñ=10-16
#ÐŸÑ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ el1
el1 = F1 / (m.pi * avg_diameter * m.sin(m.radians(alfa1_e)))
#ÐžÐ¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ ÑÑ‚ÐµÐ¿ÐµÐ½Ð¸ Ð¿Ð°Ñ€Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ eÐ¾Ð¿Ñ‚
e_opt = 4 * m.sqrt(el1) #Ñ‚Ð°Ðº ÐºÐ°Ðº Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»Ð¾ÑÑŒ Ð±Ð¾Ð»ÑŒÑˆÐµ 0,85 Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÐ¼ e_opt = 0.85
print(e_opt)
e_opt = 0.85
#Ð’Ñ‹ÑÐ¾Ñ‚Ð° ÑÐ¾Ð¿Ð»Ð¾Ð²Ñ‹Ñ… Ð»Ð¾Ð¿Ð°Ñ‚Ð¾Ðº ð‘™1
l1 = el1 / e_opt
l1

